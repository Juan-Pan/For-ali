<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sampaguitas para Ali</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/brython@3.12.0/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.12.0/brython_stdlib.js"></script>
    
    <style>
        :root {
            --bg-color: #fcfaf2;
            --text-color: #4a5d23;
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            background-color: var(--bg-color);
            font-family: 'Lora', serif;
            color: var(--text-color);
            overflow: hidden;
            position: relative;
        }

        body::before {
             content: "";
             position: absolute;
             top: 0; left: 0; width: 100%; height: 100%;
             background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
             pointer-events: none;
             z-index: 0;
        }

        .draggable {
            position: absolute;
            cursor: grab;
            user-select: none;
            touch-action: none;
            z-index: 10;
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.1));
            transition: transform 0.1s;
        }

        .draggable:active {
            cursor: grabbing;
            transform: scale(1.05);
            z-index: 100;
        }

        .flower-svg {
            width: 180px;
            height: 180px;
        }

        .matcha-svg {
            width: 220px;
            height: 220px;
        }

        .main-text {
            font-size: 4rem;
            font-weight: 500;
            white-space: nowrap;
            background: rgba(255, 255, 255, 0.4);
            padding: 15px 30px;
            border-radius: 50px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.6);
        }

        .white-heart {
            color: #fff;
            text-shadow: 0 0 5px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .flower-svg { width: 140px; height: 140px; }
            .matcha-svg { width: 180px; height: 180px; }
            .main-text { font-size: 3rem; }
        }
    </style>
</head>
<body onload="brython()">
    <div class="container">
        <h1>üåº Sampaguitas para Ali</h1>
        
        <div class="controls">
            <button class="btn btn-primary" onclick="startDrawing()">üåº Dibujar</button>
            <button class="btn btn-secondary" onclick="pauseDrawing()">‚è∏Ô∏è Pausar</button>
            <button class="btn btn-reset" onclick="resetDrawing()">üîÑ Reiniciar</button>
            <button class="btn btn-special" onclick="drawAliAndHeart()">üíï Ali</button>
        </div>

        <div class="speed-control">
            <label for="speed">Velocidad:</label>
            <input type="range" id="speed" min="1" max="10" value="5" onchange="updateSpeed()">
            <span class="speed-value" id="speedValue">5</span>
        </div>

        <div class="status" id="status">Cargando datos...</div>

        <div class="canvas-container">
            <canvas id="turtleCanvas" width="800" height="600"></canvas>
        </div>
    </div>

    <script type="text/python">
        from browser import document, window
        from browser.timer import set_timeout, clear_timeout
        import json

        turtle_data = None
        drawing_active = False
        current_shape = 0
        drawing_timeout = None
        turtle_speed = 5

        canvas = document['turtleCanvas']
        ctx = canvas.getContext('2d')
        canvas_width = 800
        canvas_height = 600

        turtle_x = canvas_width // 2
        turtle_y = canvas_height // 2
        turtle_pen_down = True

        def clear_canvas():
            ctx.clearRect(0, 0, canvas_width, canvas_height)
            ctx.fillStyle = '#fcfaf2'
            ctx.fillRect(0, 0, canvas_width, canvas_height)

        def set_color(r, g, b):
            ctx.strokeStyle = f'rgb({int(r*255)}, {int(g*255)}, {int(b*255)})'
            ctx.fillStyle = f'rgb({int(r*255)}, {int(g*255)}, {int(b*255)})'
            ctx.lineWidth = 1

        def pen_up():
            global turtle_pen_down
            turtle_pen_down = False

        def pen_down():
            global turtle_pen_down
            turtle_pen_down = True

        def goto(x, y):
            global turtle_x, turtle_y
            
            scale_factor = min(canvas_width, canvas_height) / 800
            scaled_x = canvas_width // 2 + x * scale_factor * 0.8
            scaled_y = canvas_height // 2 + y * scale_factor * 0.8
            
            if turtle_pen_down:
                ctx.lineTo(scaled_x, scaled_y)
            
            turtle_x = scaled_x
            turtle_y = scaled_y

        def begin_fill():
            ctx.beginPath()
            global first_point
            first_point = (turtle_x, turtle_y)

        def end_fill():
            if 'first_point' in globals():
                ctx.lineTo(first_point[0], first_point[1])
            ctx.fill()

        def load_data():
            global turtle_data
            try:
                import urllib.request
                response = urllib.request.urlopen('./assets/sampaguita_data.json')
                data = response.read()
                if isinstance(data, bytes):
                    data = data.decode('utf-8')
                turtle_data = json.loads(data)
                document['status'].textContent = "Listo para dibujar üåº"
                return True
            except Exception as e:
                document['status'].textContent = f"Error: {str(e)}"
                return False

        def draw_next():
            global current_shape, drawing_active, drawing_timeout
            
            try:
                if not drawing_active or not turtle_data:
                    return
                
                if current_shape >= len(turtle_data["coordenadas"]):
                    drawing_active = False
                    status_element = document['status']
                    status_element.textContent = "¬°Dibujado! üåºüíï"
                    status_element.className = 'status completed'
                    return
                
                shape = turtle_data["coordenadas"][current_shape]
                color = turtle_data["color"][current_shape]
                
                progress_percentage = int(((current_shape + 1) / len(turtle_data['coordenadas'])) * 100)
                document['status'].textContent = f"Dibujando... {progress_percentage}% üåº"
                
                set_color(color[0], color[1], color[2])
                begin_fill()
                
                pen_up()
                goto(shape[0][0], shape[0][1])
                pen_down()
                
                ctx.moveTo(turtle_x, turtle_y)
                
                for i in range(1, len(shape)):
                    goto(shape[i][0], shape[i][1])
                
                end_fill()
                current_shape += 1
                
                if drawing_active:
                    delay = max(5, 50 - turtle_speed * 5)
                    drawing_timeout = set_timeout(draw_next, delay)
                    
            except Exception as e:
                document['status'].textContent = f"Error en dibujo: {str(e)}"
                drawing_active = False

        def start_drawing():
            global drawing_active, current_shape, drawing_timeout
            
            if not turtle_data:
                if not load_data():
                    return
            
            if drawing_timeout:
                clear_timeout(drawing_timeout)
            
            drawing_active = True
            current_shape = 0
            clear_canvas()
            document['status'].textContent = f"Dibujando {len(turtle_data['coordenadas'])} sampaguitas..."
            draw_next()

        def pause_drawing():
            global drawing_active, drawing_timeout
            drawing_active = False
            if drawing_timeout:
                clear_timeout(drawing_timeout)
            document['status'].textContent = "Dibujo pausado üåº"

        def reset_drawing():
            global drawing_active, current_shape, drawing_timeout
            drawing_active = False
            if drawing_timeout:
                clear_timeout(drawing_timeout)
            current_shape = 0
            clear_canvas()
            document['status'].textContent = "Listo para dibujar sampaguitas üåº"

        def update_speed():
            global turtle_speed
            speed_element = document['speed']
            speed_value_element = document['speedValue']
            turtle_speed = int(speed_element.value)
            speed_value_element.textContent = str(turtle_speed)

        def draw_ali_and_heart():
            global drawing_active, drawing_timeout
            drawing_active = False
            if drawing_timeout:
                clear_timeout(drawing_timeout)
            
            clear_canvas()
            document['status'].textContent = "Dibujando Ali y coraz√≥n üíï"
            
            try:
                import urllib.request
                
                response_ali = urllib.request.urlopen('./assets/ali_data.json')
                data_ali = response_ali.read()
                if isinstance(data_ali, bytes):
                    data_ali = data_ali.decode('utf-8')
                ali_data = json.loads(data_ali)
                
                for i, shape in enumerate(ali_data["coordenadas"]):
                    color = ali_data["color"][i]
                    set_color(color[0], color[1], color[2])
                    begin_fill()
                    pen_up()
                    goto(shape[0][0], shape[0][1])
                    pen_down()
                    ctx.moveTo(turtle_x, turtle_y)
                    for j in range(1, len(shape)):
                        goto(shape[j][0], shape[j][1])
                    end_fill()
                
                response_heart = urllib.request.urlopen('./assets/heart_data.json')
                data_heart = response_heart.read()
                if isinstance(data_heart, bytes):
                    data_heart = data_heart.decode('utf-8')
                heart_data = json.loads(data_heart)
                
                for i, shape in enumerate(heart_data["coordenadas"]):
                    color = heart_data["color"][i]
                    set_color(color[0], color[1], color[2])
                    begin_fill()
                    pen_up()
                    goto(shape[0][0] + 150, shape[0][1])
                    pen_down()
                    ctx.moveTo(turtle_x, turtle_y)
                    for j in range(1, len(shape)):
                        goto(shape[j][0] + 150, shape[j][1])
                    end_fill()
                
                status_element = document['status']
                status_element.textContent = "¬°Ali y coraz√≥n dibujados! üíïü§ç"
                status_element.className = 'status completed'
                
            except Exception as e:
                document['status'].textContent = f"Error: {str(e)}"

        window.startDrawing = start_drawing
        window.pauseDrawing = pause_drawing
        window.resetDrawing = reset_drawing
        window.updateSpeed = update_speed
        window.drawAliAndHeart = draw_ali_and_heart

        clear_canvas()
        document['status'].textContent = "Cargando datos..."
        load_data()
    </script>
    
</body>
</html>